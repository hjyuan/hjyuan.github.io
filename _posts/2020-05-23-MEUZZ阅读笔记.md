---
layout:     post
title:      MEUZZ论文阅读笔记
subtitle:   模糊测试
date:       2020-05-23
author:     Jie_Y
header-img: img/post-bg-meuzz.png
catalog: true
tags:
    - 模糊测试
    - 漏洞挖掘
    - 二进制
---

# MEUZZ论文简报

## 论文信息

**题目：**

MEUZZ: Smart Seed Scheduling for Hybrid
Fuzzing(MEUZZ：用于混合模糊的智能种子调度)

**作者:**

Yaohui Chen, PhD, Northeastern University, software vulnerability

Mansour Ahmadi, postdoctoral Research Associate, Northeastern
University，Computer security, Android security

Reza Mirzazade farkhani, PhD, Northeastern University, software vulnerability
detection, exploit mitigation techniques and binary analysis

Long Lu, Assistant Professor, Northeastern University, RiS3 Lab, securing
low-level software and systems

**发表期刊（会议）:**

arXiv

**发表时间:**

2020.02

## 论文简报

现有的混合模糊测试通过预测输入效用的固定启发法来调度种子，但是这种方法无法适用于所有程序。因此论文设计了一个机器学习增强型混合模糊测试系统(MEUZZ)，其使用监督机器学习用于自适应和推广种子调度。MEUZZ根据从在相同或相似程序上做出的种子调度决策中学到的知识，确定哪些新种子将产生更好的模糊测试产量。MEUZZ的学习基于通过代码可达性和动态分析提取的一系列特征，这些特征所产生的运行时间开销可以忽略不计(以微秒为单位)。此外，MEUZZ通过评估每个选定种子的模糊性能自动推断数据标签。结果，MEUZZ通常适用于各种程序并在各种程序上执行得很好。

### 1、Why

模糊测试中的种子选择(或调度)旨在解决此问题：给定一个程序和一组种子，模糊测试应按此顺序测试种子，以在固定期间内使增益最大化。由于时间限制，concolic执行引擎只能探索(通常是很小的)种子子集，因此种子选择在混合模糊测试中非常重要。如果没有种子调度机制混合测试将探索所有输入，而concolic引擎无法跟上模糊测试的速度，因为它们运行相对较慢，并且经常遇到路径爆炸和超时；并且种子选择策略将会严重影响模糊测试的结果。

现有的选择策略都是基于启发式算法，它们在各自的基准上表现良好，但是它们无法推广适用于所有程序。并且它们都是基于从有限的测试用例或基准中获得的直觉或经验观察进行模糊测试，会造成漏报或无法检测问题。另外通过启发式算法对种子特征优先级进行划分，通过人工操作仍然无法扩展到许多特征上。

因此论文采用机器学习方法对单个程序的种子选择策略进行自动给学习。

### 2、What

整体流程如下图所示，(1)MEUZZ首先对具有预定义或空种子的程序进行模糊处理。然后，(2)它从程序以及种子中提取特征以对覆盖范围增益进行建模。此类特征可用于预测(3)未知种子可能提供的覆盖范围。然后，concolic引擎(4)从先前的步骤中接收可能具有影响力的种子，并产生变异的种子。接着，MEUZZ引导模糊器使用这些种子和其产生的突变体，通过进化算法不断测试程序。首先，预测模型是随机初始化的，因此预测质量不确定。但是随着模糊测试的持续进行，该模型将得到改进，并将提供更可靠的预测。MEUZZ分三步更新种子选择模型。首先，它推断出在(4)中选择给concolic引擎的那些种子的后代树(5)；然后，它基于先前选择的种子的后代树派生一个标签(6)；最后，它根据学习过程的类型更新或重新训练模型(7)。

![](https://i.loli.net/2020/08/10/G59rfPR3NiuwSDe.png)

#### 特征提取

MEUZZ在特征提取期间可能会遇到一些挑战，因为它需要使ML引擎适应在线风格的模糊测试工作流程。为应对此类挑战，特征工程阶段应满足以下要求：

1、实用性相关，

2、与种子/程序无关

3、在线友好

基于上述要求，作者设计了相关特征，主要包括错误触发、覆盖率、约束求解和经验四类特征。对于错误触发，使用可到达的sanitizer仪器的数量指导衡量触发错误的可能性。包括了可到达的sanitizer
检测数量和已到达的sanitizer
检测数量。首先在编译时使用UBSan对目标程序进行检测。然后，基于SVF的可达性分析用于提取可从每个分支到达的sanitizer仪器数量。如果在给定的输入上执行操作时，concolic执行可能会遇到很多先前未解决的分支，那么它将大大提高代码覆盖率。由于给定的输入仅跟随分支中的一个，因此称这些分支源自相同的条件语句为邻居分支。因此采用未发现的邻居分支的数量作为覆盖率的特征。对于给定种子触发的路径上的所有分支，在编译时记录分支及其邻居，将其邻居(如果有)与所有先前触发的分支进行比较，然后汇总每个分支以前未发现的邻居。对于约束求解，特征包括外部调用的数量、比较指令数量、间接调用的数量和路径长度。而对于经验来说，这组特征是根据现有技术的经验观察而设计的，它们可能间接影响模糊测试的性能。通过编译时插桩和运行时输入重放或通过操作系统API来提取这些特征。

#### 标签推断

在监督学习中，**标记推断**是数据预处理必不可少的阶段，但是文章旨在预测所选种子的效用，需要获得一个标签，通过该标签显示种子实用性的比例。利用遗传算法生成的输入子代树森林作为实用性判断的结果。子代树描述了Fuzzer队列中种子的父子关系，树的每个节点代表一个种子，每个边将种子连接到其一个突变体。对选择要进行concolic执行的输入进行建模为根节点。选择输入进行探索时，concolic引擎将生成运行输入的变体，以此形成子代树。测量种子的输入后代树的大小，并将其视为标签。但是计算完整的后代树是不可行的，因为如果用户从不终止模糊测试过程，它可能会无限期地增长。必须将树分析限制在一个时间窗口内，以使标签推断成为可能。具体而言，在fuzzer从concolic执行器导入种子之后等待一定数量的模糊测试epochs，以便模糊器探索导入的种子，然后计算其子树的大小。

#### 模型构建与预测

准备数据后的下一步是预测种子突出度(*即*标签)，由于种子标签是种子后代树中节点的数量，因此它们的值是连续的，需要回归模型来预测它们。在MEUZZ中嵌入一个回归模型，当模糊器生成新的种子时，模型预测种子的效用，然后将潜在的种子转移到concolic引擎。MEUZZ在模糊测试开始时只是随机地预测，因为模型仅看到了一些样本。但是，当生成更多种子时(数据在推进模型中起着至关重要的作用)，预测变得更加可靠并且模型会接收更新。

#### 模型更新

在线学习中使用递归最小二乘(RLS)算法更新线性模型。假设在时间*t处*，输入数据和标签分别为x*t*和*yt*，其中x*t*是*d*维向量。以下公式显示了如何根据从先前模型(*即*w*t*−1)获得的权重更新时间*t*处的模型权重(*即*w*t*)：

![](https://i.loli.net/2020/08/10/mHprXU8jglS1Wka.png)

其中$$C_{t}^{- 1}$$是的对$$C_{t}$$的逆，和$$C_{t}$$定义为：

![](https://i.loli.net/2020/08/10/RKw2rAeOhH6ltZj.png)

基于Woodbury公式，$$C_{t}^{- 1}$$也可以如下进行递归更新：

![](https://i.loli.net/2020/08/10/poeFdf6jSmAOYRa.png)

### 3、How

实验选择用现有工作常用的8个现实世界的基准程序进行评估，将MEUZZ与最新的灰盒模糊器(例如AFL、AFLFast和Angora以及包括QSYM和SAVIOR的混合测试系统)相比较，所有这些先前系统的种子选择模块都是基于启发式的。

![](https://i.loli.net/2020/08/10/uChYGRWOrs7SVd2.png)

下图分别显示了所有程序中每个特征重要性的分布，通过从离线随机森林模型中捕获平均减少的杂质来计算重要性得分。该图显示了新覆盖率特征的贡献在所有特征中最少。虽然很难完全忽视新覆盖率的贡献，但这表明花大量精力去追踪那些带来新覆盖的种子可能会危及探索未知种子的机会。图中的变化表明，“路径长度”和“新覆盖率”等某些特征受程序影响较小，而“可到达标签”等其他特征则与程序息息相关。如果特征的提取在很大程度上取决于静态分析，则与动态分析相比，它的精度较差，因为静态分析的灵敏度会影响精度(即流/上下文/场灵敏度)。推测这是使特征(例如Reachable
Label)更加依赖于各个程序的原因之一。

![](https://i.loli.net/2020/08/10/Xn6D4zIulpb2c8w.png)

如图显示的是检验的覆盖率结果，与没有模型初始化的情况相比，即使在开始模糊测试时，MEUZZ变体也开始表现良好。表明MEUZZ可以在不同的程序(或不同的模糊测试配置)上重用训练有素的模型，以快速引导模糊测试活动，并持续改进模型并使之适应当前程序或配置。

![](https://i.loli.net/2020/08/10/wQugkf3x9BM7NSq.png)

![](https://i.loli.net/2020/08/10/MGHnITrqd4eg3vS.png)

![](https://i.loli.net/2020/08/10/lRaHyUIVDhcWTw4.png)

![](https://i.loli.net/2020/08/10/mBKYRDXsj75VEe4.png)

下表列出了所有模糊器的分类结果。总共发现了54个独特的错误，MEUZZ胜过其他模糊测试者，发现了47个独特的错误。这表明更高的代码覆盖率与更多的经过分类的错误相关。该结果表明，MEUZZ在查找错误方面比手动制作启发式技术的最新系统更有效。

![](https://i.loli.net/2020/08/10/4LyYhaIvEZt21uK.png)

### 4、Summary

观察实验设置可以发现，MEUZZ采用监督机器学习方法性能开销较大，测试时间较长；由于首次将机器学习用于种子选择阶段，因此在提取特征时，无法确定特征是否都涵盖完全，是否有些特征未提取；在提取特征时是否存在路径爆炸的问题。

对于本文的启发，其种子选择策略比较新颖，是否可以将其应用于二进制代码相似性检测方面。而最近自然语言处理在漏洞检测方面应用较为广泛，其对于特征提取和语义提取有很大的优势，是否可以将其应用于种子选择策略。
